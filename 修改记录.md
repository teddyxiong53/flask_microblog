# 增加follower功能

follower是一个多对多的功能。

user跟post是一个一对多的关系。一个user可以发多篇post。

这个在数据库上，就是在post里加一个外键，它的值是user的id。

对对多的关系就要复杂一些。

以学生和老师来举例。就是一个多对多的关系。

希望可以找出某个老师的所有学生，或者找出某个学生的所有老师。

这个无法通过添加外键的方式来做了。

必须增加一张表。叫做关联表。

![many-to-many](../../blog_source/images/random_name/ch08-students-teachers.png)

而多对一，相当于一对多的换一个视角来看。

一对一，相当于一对多的特殊情况。

就不多讨论了。

现在我们看follower功能。

![many-to-many](../../blog_source/images/random_name/ch08-followers-schema.png)



现在访问，页面打印了

```
Method Not Allowed
The method is not allowed for the requested URL.
```

这个是为什么？

网上找了一下，说是因为我url_for('user')。而user没有写methods导致的。

先放着吧。

https://stackoverflow.com/questions/20689195/flask-error-method-not-allowed-the-method-is-not-allowed-for-the-requested-url/20689328



# 分页



# 邮箱支持

邮件主要用来修改密码等操作。

可以简单一点，就用模拟的邮件服务器。

python自带了一个。

启动邮箱服务器。

```
python -m smtpd -n -c DebuggingServer localhost:8025
```

设置环境变量。

```
set MAIL_SERVER=localhost
set MAIL_PORT=8025
```

然后安装flask-mail插件。

还要安装flask-jwt。

smtpd作为邮件服务器，目前只是测试用。

它会把收到的邮件只是打印处理。而不是真正转发到对应的邮箱里。

进行重置密码操作。smtpd这边打印了对应的内容。把url拷贝到浏览器打开就可以进行密码修改。

修改成功。

# 界面优化

基于bootstrap来做。

安装flask-bootstrap

我们把页面都继承自bootstrap/base.html。这个页面不可见。但是你可以用。

# 时间日期

这个就是用flask-moment来做。

# 国际化和本地化

用flask-babel。

我以中文为主，英文为辅助。

代码里都写中文，翻译文件里再写英文。

过程看懂了。但是暂时不改吧。

# ajax

当前用到的主要是后端的技术。

但是也可以加一下前端技术进来。

加一个动态翻译功能进来。

因为当前网站虽然可以做国际化。但是用户发的post可能是用不同的语言写的。

我们希望可以把这些其他语言的内容翻译成我们懂的语言。

这个就很适合用ajax来做。

流程是：

1、识别出待翻译的语言。

2、还希望知道目标语言，就是用户的当前语言。这样只需要放一个按钮就好了。

3、ajax发送消息给第三方的翻译api。

4、收到翻译结果，在页面上显示。

先看第一步，识别出post用的语言。

这个python有一个库，叫guess_language。

```
pip install guess_language-spirit
```

为了节省时间，不用每次都去检查post的语言。

我们在post的数据库表里加一个字段，language。

然后更新一下数据库。





